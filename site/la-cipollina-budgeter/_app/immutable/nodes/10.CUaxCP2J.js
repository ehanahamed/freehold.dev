import{P as D}from"../chunks/juNQPxT-.js";import{f as It,a as u,d as ae,e as m}from"../chunks/DehP6Mmi.js";import{p as _t,t as R,a as mt,a7 as T,a9 as re,aa as oe,a2 as e,a3 as i,a5 as f,a4 as a,o as s,a6 as g}from"../chunks/abUTAAem.js";import{s as W}from"../chunks/Dgg-Cmmx.js";import{i as A}from"../chunks/C1hVJviJ.js";import{e as se,i as ne}from"../chunks/BddKktbU.js";import{s as G,a as Z,c as St,r as Q}from"../chunks/DnMzuOnq.js";import{t as Pt,f as At}from"../chunks/BRpqZUsj.js";import{b as Y}from"../chunks/C-FQ8Ejh.js";import{B as ie}from"../chunks/V-Q0yVa9.js";import{P as de}from"../chunks/DRdfk9kd.js";import{T as Ct,M as le}from"../chunks/Dp0h5tl0.js";import{C as z}from"../chunks/DuO0dWcV.js";import{P as ce}from"../chunks/CsDyWTN1.js";import{p as $}from"../chunks/DVTK6F6p.js";import{C as ve}from"../chunks/DGqTA5Ul.js";import{b as ut}from"../chunks/Cq-YqXpB.js";import{g as xt}from"../chunks/BbhGFCcF.js";async function ue({fetch:p}){if(window.localStorage){let t=localStorage.getItem("budgeter:auth");if(!t)return{authed:!1,PUBLIC_API_URL:D};try{const n=await(await p(D+"/users",{method:"GET",headers:{Authorization:"Bearer "+t}})).json(),d=await(await p(D+"/authed-user",{method:"GET",headers:{Authorization:"Bearer "+t}})).json();return{authed:!0,users:n,authedUser:d,PUBLIC_API_URL:D}}catch(n){return console.error("Error while getting users in settings' load func: ",n),{authed:!1,users:!0,PUBLIC_API_URL:D}}}}const ia=Object.freeze(Object.defineProperty({__proto__:null,load:ue},Symbol.toStringTag,{value:"Module"}));var _e=It('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentcolor"><path d="M144 144v48h160v-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zm-64 48v-48C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16z"></path></svg>');function vt(p,t){_t(t,!0);let n=$(t,"width",3,"1rem"),d=$(t,"height",3,"1rem");var c=_e();R(()=>{G(c,"width",n()),G(c,"height",d()),Z(c,0,St(t.class))}),u(p,c),mt()}var me=It('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentcolor"><path d="M224 160c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-53 0-96 43-96 96v256c0 53 43 96 96 96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32-14.3-32-32V192c0-17.7 14.3-32 32-32h64zm342.6 182.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l73.4 73.4H256c-17.7 0-32 14.3-32 32s14.3 32 32 32h210.7l-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"></path></svg>');function he(p,t){_t(t,!0);let n=$(t,"width",3,"1rem"),d=$(t,"height",3,"1rem");var c=me();R(()=>{G(c,"width",n()),G(c,"height",d()),Z(c,0,St(t.class))}),u(p,c),mt()}async function fe(p,t,n,d,c){try{const C=await(await fetch(t.data.PUBLIC_API_URL+"/users/"+s(n)[s(d)].id,{method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth")}})).json();C!=null&&C.success?(s(n).splice(s(d),1),g(n,s(n),!0)):(console.log(C),alert("Error, couldn't delete ???"))}catch(C){console.error("Error while deleting user: ",C),alert("Error deleting user :( ")}finally{g(c,!1),g(d,-1)}}var ge=()=>{localStorage.setItem("budgeter:showWeekNums","false"),window.location.reload()},we=()=>{localStorage.setItem("budgeter:showWeekNums","true"),window.location.reload()},be=()=>{localStorage.removeItem("budgeter:auth"),xt(ut)},pe=m("<p>Add/Edit Users</p>"),ye=m("<p>Users:</p>"),Ue=async function(p,t,n){try{const d=await(await fetch(t.data.PUBLIC_API_URL+"/users/"+s(n).id,{method:"PATCH",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth"),"Content-Type":"application/json"},body:JSON.stringify({username:s(n).username})})).json();d.error&&(console.log(d),alert("Error, couldn't update ???"))}catch(d){console.error("Error while updating username: ",d),alert("Error updating username :( ")}finally{s(n).editUsername=!1}},ke=m('<td><div class="flex"><input type="text" placeholder="Username" style="width: 14rem;"/> <button><!> Save</button></div></td>'),Pe=(p,t)=>{s(t).editUsername=!0},Ae=async(p,t,n)=>{try{const c=await(await fetch(`${t.data.PUBLIC_API_URL}/users/${s(n).id}`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("budgeter:auth")}`,"Content-Type":"application/json"},body:JSON.stringify({admin:!1})})).json();c.id?window.location.reload():(console.log(c),alert("it seems to have not worked"))}catch(d){console.error(d),alert("something didn't work")}},Ce=m('<button class="ohno"><!> Remove Admin</button>'),Ie=async(p,t,n)=>{try{const c=await(await fetch(`${t.data.PUBLIC_API_URL}/users/${s(n).id}`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("budgeter:auth")}`,"Content-Type":"application/json"},body:JSON.stringify({admin:!0})})).json();c.id?window.location.reload():(console.log(c),alert("it seems to have not worked"))}catch(d){console.error(d),alert("something didn't work")}},Se=m("<button><!> Give Admin</button>"),xe=m('<button class="ohno"><!> Delete</button>'),Be=m('<div class="dropdown" tabindex="0"><button class="icon-only-button"><!></button> <div class="content"><button><!> Edit Username</button> <button><!> Edit Password</button> <!> <!></div></div>'),Le=m('<td><div class="flex" style="justify-content: space-between; align-items: center; align-content: center;"><span> </span> <!></div></td>'),Ee=m("<tr><!></tr>"),Ne=m('<tr><td><div class="flex col"><input type="text" placeholder="Username" style="width: 14rem;"/> <input type="password" placeholder="Password" style="width: 14rem;"/> <button style="width: 14rem;"><!> Add</button> <button class="alt" style="width: 14rem;">Cancel</button></div></td></tr>'),je=m("<tr><td><button><!> Add</button></td></tr>"),Te=m('<p class="fg0">Admin users can add/edit other users.<br/> Normal users can only change their own username and password.</p>'),ze=m('<p class="fg0">Only admin users can add/edit other users.<br/> Normal users can only change their own username and password.</p>'),Re=(p,t,n)=>{g(t,!1),g(n,-1)},Oe=m('<div class="modal"><div class="content"><p> </p> <div class="flex"><button class="ohno"><!> Delete</button> <button class="alt">Cancel</button></div></div></div>'),Me=m('<p class="fg0"><!> Changing your password will also sign you out (on all devices)</p>'),He=m(`<p class="fg0"><!> Changing this user's password will also sign them out (on all devices)</p>`),Je=m('<div class="modal"><div class="content"><p> </p> <input type="password" placeholder="New Password"/> <div class="flex"><button><!> Save</button> <button class="alt">Cancel</button></div> <!></div></div>'),De=m('<div class="grid page" style="margin-top: 4rem; margin-bottom: 10rem;"><div class="content"><h4 style="margin-bottom: 0px; text-align: center;">Settings</h4> <div style="margin-bottom: 2rem;"><a class="button faint"><!> Back</a></div> <p>Show week numbers?</p> <div class="combo-select" style="margin-bottom: 4rem"><button><!> Hide</button> <button><!> Show</button></div> <div style="margin-bottom: 2rem;"><p> </p> <p class="fg0" style="margin-top: 0.4rem;"> </p> <div class="flex"><button class="ohno alt"><!> Sign Out</button></div></div> <!> <table style="min-width: 17rem;"><tbody><!><!></tbody></table> <!></div></div> <!> <!>',1);function da(p,t){_t(t,!0);let n=T(re(t.data.users)),d=T(!1),c=T(-1),C=T(!1),L=T(-1),O,V=T(!1),E,N;async function Bt(o,r){try{const l=await(await fetch(t.data.PUBLIC_API_URL+"/users",{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth"),"Content-Type":"application/json"},body:JSON.stringify({username:o,newPassword:r})})).json();l!=null&&l.id?s(n).push({id:l.id,username:o}):(console.log(l),console.error("id not returned?"))}catch(l){console.error("Error adding user: ",l),alert("Error while adding user :( ")}}var ht=De(),tt=oe(ht),ft=e(tt),et=i(e(ft),2),at=e(et),Lt=e(at);ie(Lt,{}),f(),a(at),a(et);var rt=i(et,4),M=e(rt);Z(M,1,`left ${localStorage.getItem("budgeter:showWeekNums")=="true"?"":"selected"}`),M.__click=[ge];var Et=e(M);z(Et,{class:"combo-selected-icon"}),f(),a(M);var X=i(M,2);Z(X,1,`right ${localStorage.getItem("budgeter:showWeekNums")=="true"?"selected":""}`),X.__click=[we];var Nt=e(X);z(Nt,{class:"combo-selected-icon"}),f(),a(X),a(rt);var ot=i(rt,2),st=e(ot),jt=e(st);a(st);var nt=i(st,2),Tt=e(nt);a(nt);var gt=i(nt,2),it=e(gt);it.__click=[be];var zt=e(it);he(zt,{}),f(),a(it),a(gt),a(ot);var wt=i(ot,2);{var Rt=o=>{var r=pe();u(o,r)},Ot=o=>{var r=ye();u(o,r)};A(wt,o=>{t.data.authedUser.admin?o(Rt):o(Ot,!1)})}var dt=i(wt,2),bt=e(dt),pt=e(bt);se(pt,17,()=>s(n),ne,(o,r,l)=>{var v=Ee(),U=e(v);{var w=h=>{var k=ke(),I=e(k),B=e(I);Q(B);var j=i(B,2);j.__click=[Ue,t,r];var H=e(j);z(H,{}),f(),a(j),a(I),a(k),Y(B,()=>s(r).username,b=>s(r).username=b),u(h,k)},_=h=>{var k=Le(),I=e(k),B=e(I),j=e(B,!0);a(B);var H=i(B,2);{var b=y=>{var P=Be(),lt=e(P),Ft=e(lt);le(Ft,{}),a(lt);var Ut=i(lt,2),q=e(Ut);q.__click=[Pe,r];var Kt=e(q);de(Kt,{}),f(),a(q);var F=i(q,2);F.__click=()=>{g(L,l,!0),g(C,!0)};var Qt=e(F);vt(Qt,{}),f(),a(F);var kt=i(F,2);{var Yt=x=>{var S=Ce();S.__click=[Ae,t,r];var J=e(S);ve(J,{}),f(),a(S),u(x,S)},Zt=(x,S)=>{{var J=ct=>{var K=Se();K.__click=[Ie,t,r];var ee=e(K);z(ee,{}),f(),a(K),u(ct,K)};A(x,ct=>{t.data.authedUser.admin&&s(r).id!=t.data.authedUser.id&&ct(J)},S)}};A(kt,x=>{t.data.authedUser.admin&&s(r).admin&&s(r).id!=t.data.authedUser.id?x(Yt):x(Zt,!1)})}var $t=i(kt,2);{var te=x=>{var S=xe();S.__click=()=>{g(c,l,!0),g(d,!0)};var J=e(S);Ct(J,{}),f(),a(S),u(x,S)};A($t,x=>{t.data.authedUser.admin&&x(te)})}a(Ut),a(P),u(y,P)};A(H,y=>{(t.data.authedUser.admin||s(r).id==t.data.authedUser.id)&&y(b)})}a(I),a(k),R(()=>W(j,s(r).username)),u(h,k)};A(U,h=>{s(r).editUsername?h(w):h(_,!1)})}a(v),u(o,v)});var Mt=i(pt);{var Ht=o=>{var r=Ne(),l=e(r),v=e(l),U=e(v);Q(U);var w=i(U,2);Q(w);var _=i(w,2);_.__click=()=>{E==""||N==""||(Bt(E,N),g(V,!1),E="",N="")};var h=e(_);z(h,{}),f(),a(_);var k=i(_,2);k.__click=()=>{g(V,!1),E="",N=""},a(v),a(l),a(r),Y(U,()=>E,I=>E=I),Y(w,()=>N,I=>N=I),u(o,r)},Jt=(o,r)=>{{var l=v=>{var U=je(),w=e(U),_=e(w);_.__click=function(){E="",N="",g(V,!0)};var h=e(_);ce(h,{}),f(),a(_),a(w),a(U),u(v,U)};A(o,v=>{t.data.authedUser.admin&&v(l)},r)}};A(Mt,o=>{s(V)?o(Ht):o(Jt,!1)})}a(bt),a(dt);var Dt=i(dt,2);{var Wt=o=>{var r=Te();u(o,r)},Gt=o=>{var r=ze();u(o,r)};A(Dt,o=>{t.data.authedUser.admin?o(Wt):o(Gt,!1)})}a(ft),a(tt);var yt=i(tt,2);{var Vt=o=>{var r=Oe(),l=e(r),v=e(l),U=e(v);a(v);var w=i(v,2),_=e(w);_.__click=[fe,t,n,c,d];var h=e(_);Ct(h,{}),f(),a(_);var k=i(_,2);k.__click=[Re,d,c],a(w),a(l),a(r),R(()=>W(U,`Are you sure you want to delete "${s(n)[s(c)].username??""}"?`)),Pt(3,r,()=>At,()=>({duration:200})),u(o,r)};A(yt,o=>{s(d)&&o(Vt)})}var Xt=i(yt,2);{var qt=o=>{var r=Je(),l=e(r),v=e(l),U=e(v);a(v);var w=i(v,2);Q(w);var _=i(w,2),h=e(_);h.__click=async function(){var b,y;try{const P=await(await fetch(t.data.PUBLIC_API_URL+"/users/"+s(n)[s(L)].id,{method:"PATCH",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth"),"Content-Type":"application/json"},body:JSON.stringify({newPassword:O})})).json();P.error&&(console.log(P),alert("Error, couldn't update ???"))}catch(P){console.error("Error while updating user password: ",P),alert("Error updating user password :( ")}finally{s(n)[s(L)].id==((y=(b=t.data)==null?void 0:b.authedUser)==null?void 0:y.id)&&xt(ut),g(C,!1),g(L,-1),O=""}};var k=e(h);z(k,{}),f(),a(h);var I=i(h,2);I.__click=()=>{g(C,!1),g(L,-1),O=""},a(_);var B=i(_,2);{var j=b=>{var y=Me(),P=e(y);vt(P,{}),f(),a(y),u(b,y)},H=b=>{var y=He(),P=e(y);vt(P,{}),f(),a(y),u(b,y)};A(B,b=>{s(n)[s(L)].id==t.data.authedUser.id?b(j):b(H,!1)})}a(l),a(r),R(()=>W(U,`New password for "${s(n)[s(L)].username??""}"`)),Y(w,()=>O,b=>O=b),Pt(3,r,()=>At,()=>({duration:200})),u(o,r)};A(Xt,o=>{s(C)&&o(qt)})}R(()=>{var o,r,l,v;G(at,"href",ut),W(jt,`Currently logged in as "${((r=(o=t.data)==null?void 0:o.authedUser)==null?void 0:r.username)??""}"`),W(Tt,`Role: ${(v=(l=t.data)==null?void 0:l.authedUser)!=null&&v.admin?"admin user":"normal user"}`)}),u(p,ht),mt()}ae(["click"]);export{da as component,ia as universal};
