import{P as D}from"../chunks/juNQPxT-.js";import{f as At,a as u,e as te,d as m}from"../chunks/BiStlCBM.js";import{p as _t,t as R,a as mt,a7 as T,a8 as ee,a9 as ae,a2 as e,a5 as i,a3 as g,a4 as a,o as s,aa as f}from"../chunks/CuyIZn2s.js";import{s as W}from"../chunks/D1ZQew5F.js";import{i as A}from"../chunks/DI4tddXV.js";import{e as re,i as oe}from"../chunks/nELTDHYw.js";import{s as G,a as Z,c as Ct,r as Q}from"../chunks/uNlJViDn.js";import{b as Y}from"../chunks/CqxP_0jr.js";import{B as se}from"../chunks/CxqwulL1.js";import{P as ne}from"../chunks/DkuFtbiq.js";import{T as Pt,M as ie}from"../chunks/ClNHbbKn.js";import{C as z}from"../chunks/D7r-EodX.js";import{P as de}from"../chunks/sp7bv9Oi.js";import{p as $}from"../chunks/Cexfq8rT.js";import{C as le}from"../chunks/MARklwlx.js";import{b as ut}from"../chunks/CfXCE_Md.js";import{g as It}from"../chunks/Kr6LqN9i.js";async function ce({fetch:p}){if(window.localStorage){let t=localStorage.getItem("budgeter:auth");if(!t)return{authed:!1,PUBLIC_API_URL:D};try{const n=await(await p(D+"/users",{method:"GET",headers:{Authorization:"Bearer "+t}})).json(),d=await(await p(D+"/authed-user",{method:"GET",headers:{Authorization:"Bearer "+t}})).json();return{authed:!0,users:n,authedUser:d,PUBLIC_API_URL:D}}catch(n){return console.error("Error while getting users in settings' load func: ",n),{authed:!1,users:!0,PUBLIC_API_URL:D}}}}const oa=Object.freeze(Object.defineProperty({__proto__:null,load:ce},Symbol.toStringTag,{value:"Module"}));var ve=At('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" fill="currentcolor"><path d="M144 144v48h160v-48c0-44.2-35.8-80-80-80s-80 35.8-80 80zm-64 48v-48C80 64.5 144.5 0 224 0s144 64.5 144 144v48h16c35.3 0 64 28.7 64 64v192c0 35.3-28.7 64-64 64H64c-35.3 0-64-28.7-64-64V256c0-35.3 28.7-64 64-64h16z"></path></svg>');function vt(p,t){_t(t,!0);let n=$(t,"width",3,"1rem"),d=$(t,"height",3,"1rem");var c=ve();R(()=>{G(c,"width",n()),G(c,"height",d()),Z(c,0,Ct(t.class))}),u(p,c),mt()}var ue=At('<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640" fill="currentcolor"><path d="M224 160c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-53 0-96 43-96 96v256c0 53 43 96 96 96h64c17.7 0 32-14.3 32-32s-14.3-32-32-32h-64c-17.7 0-32-14.3-32-32V192c0-17.7 14.3-32 32-32h64zm342.6 182.6c12.5-12.5 12.5-32.8 0-45.3l-128-128c-12.5-12.5-32.8-12.5-45.3 0s-12.5 32.8 0 45.3l73.4 73.4H256c-17.7 0-32 14.3-32 32s14.3 32 32 32h210.7l-73.4 73.4c-12.5 12.5-12.5 32.8 0 45.3s32.8 12.5 45.3 0l128-128z"></path></svg>');function _e(p,t){_t(t,!0);let n=$(t,"width",3,"1rem"),d=$(t,"height",3,"1rem");var c=ue();R(()=>{G(c,"width",n()),G(c,"height",d()),Z(c,0,Ct(t.class))}),u(p,c),mt()}async function me(p,t,n,d,c){try{const C=await(await fetch(t.data.PUBLIC_API_URL+"/users/"+s(n)[s(d)].id,{method:"DELETE",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth")}})).json();C!=null&&C.success?(s(n).splice(s(d),1),f(n,s(n),!0)):(console.log(C),alert("Error, couldn't delete ???"))}catch(C){console.error("Error while deleting user: ",C),alert("Error deleting user :( ")}finally{f(c,!1),f(d,-1)}}var he=()=>{localStorage.setItem("budgeter:showWeekNums","false"),window.location.reload()},ge=()=>{localStorage.setItem("budgeter:showWeekNums","true"),window.location.reload()},fe=()=>{localStorage.removeItem("budgeter:auth"),It(ut)},we=m("<p>Add/Edit Users</p>"),be=m("<p>Users:</p>"),pe=async function(p,t,n){try{const d=await(await fetch(t.data.PUBLIC_API_URL+"/users/"+s(n).id,{method:"PATCH",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth"),"Content-Type":"application/json"},body:JSON.stringify({username:s(n).username})})).json();d.error&&(console.log(d),alert("Error, couldn't update ???"))}catch(d){console.error("Error while updating username: ",d),alert("Error updating username :( ")}finally{s(n).editUsername=!1}},ye=m('<td><div class="flex"><input type="text" placeholder="Username" style="width: 14rem;"/> <button><!> Save</button></div></td>'),Ue=(p,t)=>{s(t).editUsername=!0},ke=async(p,t,n)=>{try{const c=await(await fetch(`${t.data.PUBLIC_API_URL}/users/${s(n).id}`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("budgeter:auth")}`,"Content-Type":"application/json"},body:JSON.stringify({admin:!1})})).json();c.id?window.location.reload():(console.log(c),alert("it seems to have not worked"))}catch(d){console.error(d),alert("something didn't work")}},Pe=m('<button class="ohno"><!> Remove Admin</button>'),Ae=async(p,t,n)=>{try{const c=await(await fetch(`${t.data.PUBLIC_API_URL}/users/${s(n).id}`,{method:"PATCH",headers:{Authorization:`Bearer ${localStorage.getItem("budgeter:auth")}`,"Content-Type":"application/json"},body:JSON.stringify({admin:!0})})).json();c.id?window.location.reload():(console.log(c),alert("it seems to have not worked"))}catch(d){console.error(d),alert("something didn't work")}},Ce=m("<button><!> Give Admin</button>"),Ie=m('<button class="ohno"><!> Delete</button>'),Se=m('<div class="dropdown"><button class="icon-only-button"><!></button> <div class="content"><button><!> Edit Username</button> <button><!> Edit Password</button> <!> <!></div></div>'),xe=m('<td><div class="flex" style="justify-content: space-between; align-items: center; align-content: center;"><span> </span> <!></div></td>'),Be=m("<tr><!></tr>"),Le=m('<tr><td><div class="flex col"><input type="text" placeholder="Username" style="width: 14rem;"/> <input type="password" placeholder="Password" style="width: 14rem;"/> <button style="width: 14rem;"><!> Add</button> <button class="alt" style="width: 14rem;">Cancel</button></div></td></tr>'),Ee=m("<tr><td><button><!> Add</button></td></tr>"),Ne=m('<p class="fg0">Admin users can add/edit other users.<br/> Normal users can only change their own username and password.</p>'),je=m('<p class="fg0">Only admin users can add/edit other users.<br/> Normal users can only change their own username and password.</p>'),Te=(p,t,n)=>{f(t,!1),f(n,-1)},ze=m('<div class="modal"><div class="content"><p> </p> <div class="flex"><button class="ohno"><!> Delete</button> <button class="alt">Cancel</button></div></div></div>'),Re=m('<p class="fg0"><!> Changing your password will also sign you out (on all devices)</p>'),Oe=m(`<p class="fg0"><!> Changing this user's password will also sign them out (on all devices)</p>`),Me=m('<div class="modal"><div class="content"><p> </p> <input type="password" placeholder="New Password"/> <div class="flex"><button><!> Save</button> <button class="alt">Cancel</button></div> <!></div></div>'),He=m('<div class="grid page" style="margin-top: 4rem; margin-bottom: 10rem;"><div class="content"><h4 style="margin-bottom: 0px; text-align: center;">Settings</h4> <div style="margin-bottom: 2rem;"><a class="button faint"><!> Back</a></div> <p>Show week numbers?</p> <div class="combo-select" style="margin-bottom: 4rem"><button><!> Hide</button> <button><!> Show</button></div> <div style="margin-bottom: 2rem;"><p> </p> <p class="fg0" style="margin-top: 0.4rem;"> </p> <div class="flex"><button class="ohno alt"><!> Sign Out</button></div></div> <!> <table style="min-width: 17rem;"><tbody><!><!></tbody></table> <!></div></div> <!> <!>',1);function sa(p,t){_t(t,!0);let n=T(ee(t.data.users)),d=T(!1),c=T(-1),C=T(!1),L=T(-1),O,V=T(!1),E,N;async function St(o,r){try{const l=await(await fetch(t.data.PUBLIC_API_URL+"/users",{method:"POST",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth"),"Content-Type":"application/json"},body:JSON.stringify({username:o,newPassword:r})})).json();l!=null&&l.id?s(n).push({id:l.id,username:o}):(console.log(l),console.error("id not returned?"))}catch(l){console.error("Error adding user: ",l),alert("Error while adding user :( ")}}var ht=He(),tt=ae(ht),gt=e(tt),et=i(e(gt),2),at=e(et),xt=e(at);se(xt,{}),g(),a(at),a(et);var rt=i(et,4),M=e(rt);Z(M,1,`left ${localStorage.getItem("budgeter:showWeekNums")=="true"?"":"selected"}`),M.__click=[he];var Bt=e(M);z(Bt,{class:"combo-selected-icon"}),g(),a(M);var X=i(M,2);Z(X,1,`right ${localStorage.getItem("budgeter:showWeekNums")=="true"?"selected":""}`),X.__click=[ge];var Lt=e(X);z(Lt,{class:"combo-selected-icon"}),g(),a(X),a(rt);var ot=i(rt,2),st=e(ot),Et=e(st);a(st);var nt=i(st,2),Nt=e(nt);a(nt);var ft=i(nt,2),it=e(ft);it.__click=[fe];var jt=e(it);_e(jt,{}),g(),a(it),a(ft),a(ot);var wt=i(ot,2);{var Tt=o=>{var r=we();u(o,r)},zt=o=>{var r=be();u(o,r)};A(wt,o=>{t.data.authedUser.admin?o(Tt):o(zt,!1)})}var dt=i(wt,2),bt=e(dt),pt=e(bt);re(pt,17,()=>s(n),oe,(o,r,l)=>{var v=Be(),U=e(v);{var w=h=>{var k=ye(),I=e(k),B=e(I);Q(B);var j=i(B,2);j.__click=[pe,t,r];var H=e(j);z(H,{}),g(),a(j),a(I),a(k),Y(B,()=>s(r).username,b=>s(r).username=b),u(h,k)},_=h=>{var k=xe(),I=e(k),B=e(I),j=e(B,!0);a(B);var H=i(B,2);{var b=y=>{var P=Se(),lt=e(P),Xt=e(lt);ie(Xt,{}),a(lt);var Ut=i(lt,2),q=e(Ut);q.__click=[Ue,r];var qt=e(q);ne(qt,{}),g(),a(q);var F=i(q,2);F.__click=()=>{f(L,l,!0),f(C,!0)};var Ft=e(F);vt(Ft,{}),g(),a(F);var kt=i(F,2);{var Kt=x=>{var S=Pe();S.__click=[ke,t,r];var J=e(S);le(J,{}),g(),a(S),u(x,S)},Qt=(x,S)=>{{var J=ct=>{var K=Ce();K.__click=[Ae,t,r];var $t=e(K);z($t,{}),g(),a(K),u(ct,K)};A(x,ct=>{t.data.authedUser.admin&&s(r).id!=t.data.authedUser.id&&ct(J)},S)}};A(kt,x=>{t.data.authedUser.admin&&s(r).admin&&s(r).id!=t.data.authedUser.id?x(Kt):x(Qt,!1)})}var Yt=i(kt,2);{var Zt=x=>{var S=Ie();S.__click=()=>{f(c,l,!0),f(d,!0)};var J=e(S);Pt(J,{}),g(),a(S),u(x,S)};A(Yt,x=>{t.data.authedUser.admin&&x(Zt)})}a(Ut),a(P),u(y,P)};A(H,y=>{(t.data.authedUser.admin||s(r).id==t.data.authedUser.id)&&y(b)})}a(I),a(k),R(()=>W(j,s(r).username)),u(h,k)};A(U,h=>{s(r).editUsername?h(w):h(_,!1)})}a(v),u(o,v)});var Rt=i(pt);{var Ot=o=>{var r=Le(),l=e(r),v=e(l),U=e(v);Q(U);var w=i(U,2);Q(w);var _=i(w,2);_.__click=()=>{E==""||N==""||(St(E,N),f(V,!1),E="",N="")};var h=e(_);z(h,{}),g(),a(_);var k=i(_,2);k.__click=()=>{f(V,!1),E="",N=""},a(v),a(l),a(r),Y(U,()=>E,I=>E=I),Y(w,()=>N,I=>N=I),u(o,r)},Mt=(o,r)=>{{var l=v=>{var U=Ee(),w=e(U),_=e(w);_.__click=function(){E="",N="",f(V,!0)};var h=e(_);de(h,{}),g(),a(_),a(w),a(U),u(v,U)};A(o,v=>{t.data.authedUser.admin&&v(l)},r)}};A(Rt,o=>{s(V)?o(Ot):o(Mt,!1)})}a(bt),a(dt);var Ht=i(dt,2);{var Jt=o=>{var r=Ne();u(o,r)},Dt=o=>{var r=je();u(o,r)};A(Ht,o=>{t.data.authedUser.admin?o(Jt):o(Dt,!1)})}a(gt),a(tt);var yt=i(tt,2);{var Wt=o=>{var r=ze(),l=e(r),v=e(l),U=e(v);a(v);var w=i(v,2),_=e(w);_.__click=[me,t,n,c,d];var h=e(_);Pt(h,{}),g(),a(_);var k=i(_,2);k.__click=[Te,d,c],a(w),a(l),a(r),R(()=>W(U,`Are you sure you want to delete "${s(n)[s(c)].username??""}"?`)),u(o,r)};A(yt,o=>{s(d)&&o(Wt)})}var Gt=i(yt,2);{var Vt=o=>{var r=Me(),l=e(r),v=e(l),U=e(v);a(v);var w=i(v,2);Q(w);var _=i(w,2),h=e(_);h.__click=async function(){var b,y;try{const P=await(await fetch(t.data.PUBLIC_API_URL+"/users/"+s(n)[s(L)].id,{method:"PATCH",headers:{Authorization:"Bearer "+localStorage.getItem("budgeter:auth"),"Content-Type":"application/json"},body:JSON.stringify({newPassword:O})})).json();P.error&&(console.log(P),alert("Error, couldn't update ???"))}catch(P){console.error("Error while updating user password: ",P),alert("Error updating user password :( ")}finally{s(n)[s(L)].id==((y=(b=t.data)==null?void 0:b.authedUser)==null?void 0:y.id)&&It(ut),f(C,!1),f(L,-1),O=""}};var k=e(h);z(k,{}),g(),a(h);var I=i(h,2);I.__click=()=>{f(C,!1),f(L,-1),O=""},a(_);var B=i(_,2);{var j=b=>{var y=Re(),P=e(y);vt(P,{}),g(),a(y),u(b,y)},H=b=>{var y=Oe(),P=e(y);vt(P,{}),g(),a(y),u(b,y)};A(B,b=>{s(n)[s(L)].id==t.data.authedUser.id?b(j):b(H,!1)})}a(l),a(r),R(()=>W(U,`New password for "${s(n)[s(L)].username??""}"`)),Y(w,()=>O,b=>O=b),u(o,r)};A(Gt,o=>{s(C)&&o(Vt)})}R(()=>{var o,r,l,v;G(at,"href",ut),W(Et,`Currently logged in as "${((r=(o=t.data)==null?void 0:o.authedUser)==null?void 0:r.username)??""}"`),W(Nt,`Role: ${(v=(l=t.data)==null?void 0:l.authedUser)!=null&&v.admin?"admin user":"normal user"}`)}),u(p,ht),mt()}te(["click"]);export{sa as component,oa as universal};
